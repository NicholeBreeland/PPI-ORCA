---
title: "Maternal Attributes Enhance Infant Cooperation"
author: "Nichole Breeland"
date: "19/02/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
options(width = 60)
library(knitr)
opts_chunk$set(tidy.opts=list(width.cutoff=60),tidy=TRUE)
df <- read.csv("ParentChild_Coop_ReducedData.csv", stringsAsFactors = FALSE)
```


```{r load packages, include=FALSE}
library(car)
library(e1071)
library(MASS)
library(stargazer)
library(rockchalk)
library(mice)
library(miceadds)
library(polycor)
library(tidyverse)
library(tidyverse)
library(lavaan)
library(semTools)
library(lavaanPlot)
```

```{r cleaned data file set up,eval = FALSE, include = FALSE}

#Dataset with cooperative competence measures and parent variables (CVS and Big 5)
all.data = read.csv("P1_PPI_Ability_Anticipation_Workingset.csv", stringsAsFactors = FALSE)
#Dataset with SES (parent education), Infant Ethnicity, P5 and P6 Age
eth.data = read.csv("Demographics_SES_Ethnicity.csv", stringsAsFactors = FALSE)
eth.data[eth.data == 999] <- NA
all.data[all.data == 999] <- NA
all.data[all.data == 777] <- NA
options(scipen = 999) #turns off scientific notation

#Gender category assign
all.data$Gender_Label[all.data$Gender == 1] <- "Male"
all.data$Gender_Label[all.data$Gender == 2] <- "Female"

#Create CVS 
all.data$response.diff = with(all.data, Op_coop_Alt_Avg_p1 - Op_coop_Ego_Avg_p1)

#Score Big 5
all.data$NeurVol_2 = recode(all.data$NeurVol_2, "1=7; 2=6; 3=5; 4=4; 5=3;6=2; 7=1")
all.data$NeurVol_4 = recode(all.data$NeurVol_4, "1=7; 2=6; 3=5; 4=4; 5=3;6=2; 7=1")
all.data$NeurVol_6 = recode(all.data$NeurVol_6, "1=7; 2=6; 3=5; 4=4; 5=3;6=2; 7=1")
all.data$NeurVol_8 = recode(all.data$NeurVol_8, "1=7; 2=6; 3=5; 4=4; 5=3;6=2; 7=1")
all.data$NeurWith_1 = recode(all.data$NeurWith_1, "1=7; 2=6; 3=5; 4=4; 5=3;6=2; 7=1")
all.data$NeurWith_3 = recode(all.data$NeurWith_3, "1=7; 2=6; 3=5; 4=4; 5=3;6=2; 7=1")
all.data$NeurWith_5 = recode(all.data$NeurWith_5, "1=7; 2=6; 3=5; 4=4; 5=3;6=2; 7=1")
all.data$NeurWith_8 = recode(all.data$NeurWith_8, "1=7; 2=6; 3=5; 4=4; 5=3;6=2; 7=1")
all.data$AgreeComp_1 = recode(all.data$AgreeComp_1, "1=7; 2=6; 3=5; 4=4; 5=3;6=2; 7=1")
all.data$AgreeComp_4 = recode(all.data$AgreeComp_4, "1=7; 2=6; 3=5; 4=4; 5=3;6=2; 7=1")
all.data$AgreeComp_6 = recode(all.data$AgreeComp_6, "1=7; 2=6; 3=5; 4=4; 5=3;6=2; 7=1")
all.data$AgreeComp_7 = recode(all.data$AgreeComp_7, "1=7; 2=6; 3=5; 4=4; 5=3;6=2; 7=1")
all.data$AgreeComp_9 = recode(all.data$AgreeComp_9, "1=7; 2=6; 3=5; 4=4; 5=3;6=2; 7=1")
all.data$AgreePol_2 = recode(all.data$AgreePol_2, "1=7; 2=6; 3=5; 4=4; 5=3;6=2; 7=1")
all.data$AgreePol_4 = recode(all.data$AgreePol_4, "1=7; 2=6; 3=5; 4=4; 5=3;6=2; 7=1")
all.data$AgreePol_7 = recode(all.data$AgreePol_7, "1=7; 2=6; 3=5; 4=4; 5=3;6=2; 7=1")
all.data$AgreePol_8 = recode(all.data$AgreePol_8, "1=7; 2=6; 3=5; 4=4; 5=3;6=2; 7=1")
all.data$AgreePol_9 = recode(all.data$AgreePol_9, "1=7; 2=6; 3=5; 4=4; 5=3;6=2; 7=1")
all.data$AgreePol_10 = recode(all.data$AgreePol_10, "1=7; 2=6; 3=5; 4=4; 5=3;6=2; 7=1")
all.data$ConsInd_2 = recode(all.data$ConsInd_2, "1=7; 2=6; 3=5; 4=4; 5=3;6=2; 7=1")
all.data$ConsInd_3 = recode(all.data$ConsInd_3, "1=7; 2=6; 3=5; 4=4; 5=3;6=2; 7=1")
all.data$ConsInd_4 = recode(all.data$ConsInd_4, "1=7; 2=6; 3=5; 4=4; 5=3;6=2; 7=1")
all.data$ConsInd_6 = recode(all.data$ConsInd_6, "1=7; 2=6; 3=5; 4=4; 5=3;6=2; 7=1")
all.data$ConsInd_9 = recode(all.data$ConsInd_9, "1=7; 2=6; 3=5; 4=4; 5=3;6=2; 7=1")
all.data$ConsInd_10 = recode(all.data$ConsInd_10, "1=7; 2=6; 3=5; 4=4; 5=3;6=2; 7=1")
all.data$ConsOrd_1 = recode(all.data$ConsOrd_1, "1=7; 2=6; 3=5; 4=4; 5=3;6=2; 7=1")
all.data$ConsOrd_5 = recode(all.data$ConsOrd_5, "1=7; 2=6; 3=5; 4=4; 5=3;6=2; 7=1")
all.data$ConsOrd_7 = recode(all.data$ConsOrd_7, "1=7; 2=6; 3=5; 4=4; 5=3;6=2; 7=1")
all.data$ConsOrd_8 = recode(all.data$ConsOrd_8, "1=7; 2=6; 3=5; 4=4; 5=3;6=2; 7=1")
all.data$ExtraEnth_2 = recode(all.data$ExtraEnth_2, "1=7; 2=6; 3=5; 4=4; 5=3;6=2; 7=1")
all.data$ExtraEnth_3 = recode(all.data$ExtraEnth_3, "1=7; 2=6; 3=5; 4=4; 5=3;6=2; 7=1")
all.data$ExtraEnth_4 = recode(all.data$ExtraEnth_4, "1=7; 2=6; 3=5; 4=4; 5=3;6=2; 7=1")
all.data$ExtraEnth_6 = recode(all.data$ExtraEnth_6, "1=7; 2=6; 3=5; 4=4; 5=3;6=2; 7=1")
all.data$ExtraEnth_7 = recode(all.data$ExtraEnth_7, "1=7; 2=6; 3=5; 4=4; 5=3;6=2; 7=1")
all.data$ExtraAssert_3 = recode(all.data$ExtraAssert_3, "1=7; 2=6; 3=5; 4=4; 5=3;6=2; 7=1")
all.data$ExtraAssert_5 = recode(all.data$ExtraAssert_5, "1=7; 2=6; 3=5; 4=4; 5=3;6=2; 7=1")
all.data$ExtraAssert_8 = recode(all.data$ExtraAssert_8, "1=7; 2=6; 3=5; 4=4; 5=3;6=2; 7=1")
all.data$ExtraAssert_10 = recode(all.data$ExtraAssert_10, "1=7; 2=6; 3=5; 4=4; 5=3;6=2; 7=1")
all.data$OpenIntel_2 = recode(all.data$OpenIntel_2, "1=7; 2=6; 3=5; 4=4; 5=3;6=2; 7=1")
all.data$OpenIntel_5 = recode(all.data$OpenIntel_5, "1=7; 2=6; 3=5; 4=4; 5=3;6=2; 7=1")
all.data$OpenIntel_6 = recode(all.data$OpenIntel_6, "1=7; 2=6; 3=5; 4=4; 5=3;6=2; 7=1")
all.data$OpenIntel_9 = recode(all.data$OpenIntel_9, "1=7; 2=6; 3=5; 4=4; 5=3;6=2; 7=1")
all.data$Openness_5 = recode(all.data$Openness_5, "1=7; 2=6; 3=5; 4=4; 5=3;6=2; 7=1")
all.data$Openness_8 = recode(all.data$Openness_8, "1=7; 2=6; 3=5; 4=4; 5=3;6=2; 7=1")
all.data$Openness_9 = recode(all.data$Openness_9, "1=7; 2=6; 3=5; 4=4; 5=3;6=2; 7=1")
all.data$Openness_10 = recode(all.data$Openness_10, "1=7; 2=6; 3=5; 4=4; 5=3;6=2; 7=1")

#Scoring parent Big 5

all.data$Neur = rowMeans(all.data[,50:69], na.rm=TRUE)
all.data$Agree = rowMeans(all.data[,70:89], na.rm=TRUE)
all.data$Cons = rowMeans(all.data[,90:109], na.rm=TRUE)
all.data$Extra = rowMeans(all.data[,110:129], na.rm=TRUE)
all.data$Open = rowMeans(all.data[,130:149], na.rm=TRUE)

#load and right join
ipip.df <- read.csv("P6_IPIP6.csv", stringsAsFactors = FALSE)
all.data <- merge(x = all.data, y = ipip.df, by = "ID_num", all = TRUE)

#recode r coded questions
all.data$IPIP6_Q6_r = recode(all.data$IPIP6_Q6_r, "1=7; 2=6; 3=5; 4=4; 5=3;6=2; 7=1")
all.data$IPIP6_Q7_r = recode(all.data$IPIP6_Q7_r, "1=7; 2=6; 3=5; 4=4; 5=3;6=2; 7=1")
all.data$IPIP6_Q8_r = recode(all.data$IPIP6_Q8_r, "1=7; 2=6; 3=5; 4=4; 5=3;6=2; 7=1")
all.data$IPIP6_Q9_r = recode(all.data$IPIP6_Q9_r, "1=7; 2=6; 3=5; 4=4; 5=3;6=2; 7=1")
all.data$IPIP6_Q11_r = recode(all.data$IPIP6_Q11_r, "1=7; 2=6; 3=5; 4=4; 5=3;6=2; 7=1")
all.data$IPIP6_Q12_r = recode(all.data$IPIP6_Q12_r, "1=7; 2=6; 3=5; 4=4; 5=3;6=2; 7=1")
all.data$IPIP6_Q13_r = recode(all.data$IPIP6_Q13_r, "1=7; 2=6; 3=5; 4=4; 5=3;6=2; 7=1")
all.data$IPIP6_Q15_r = recode(all.data$IPIP6_Q15_r, "1=7; 2=6; 3=5; 4=4; 5=3;6=2; 7=1")
all.data$IPIP6_Q17_r = recode(all.data$IPIP6_Q17_r, "1=7; 2=6; 3=5; 4=4; 5=3;6=2; 7=1")
all.data$IPIP6_Q18_r = recode(all.data$IPIP6_Q18_r, "1=7; 2=6; 3=5; 4=4; 5=3;6=2; 7=1")
all.data$IPIP6_Q19_r = recode(all.data$IPIP6_Q19_r, "1=7; 2=6; 3=5; 4=4; 5=3;6=2; 7=1")
all.data$IPIP6_Q20_r = recode(all.data$IPIP6_Q20_r, "1=7; 2=6; 3=5; 4=4; 5=3;6=2; 7=1")
all.data$IPIP6_Q21_r = recode(all.data$IPIP6_Q21_r, "1=7; 2=6; 3=5; 4=4; 5=3;6=2; 7=1")
all.data$IPIP6_Q22_r = recode(all.data$IPIP6_Q22_r, "1=7; 2=6; 3=5; 4=4; 5=3;6=2; 7=1")
all.data$IPIP6_Q24_r = recode(all.data$IPIP6_Q24_r, "1=7; 2=6; 3=5; 4=4; 5=3;6=2; 7=1")

#scoring for questions + variable creation

#Extraversion
all.data$IPIP6_Extra <- rowMeans(subset(all.data, select = c("IPIP6_Q1", "IPIP6_Q7_r", "IPIP6_Q19_r", "IPIP6_Q23")), na.rm = TRUE)
#Agreeableness
all.data$IPIP6_Agree <- rowMeans(subset(all.data, select = c("IPIP6_Q2", "IPIP6_Q8_r", "IPIP6_Q14", "IPIP6_Q20_r")), na.rm = TRUE)
#Conscientiousness
all.data$IPIP6_Cons <- rowMeans(subset(all.data, select = c("IPIP6_Q3", "IPIP6_Q10", "IPIP6_Q11_r", "IPIP6_Q22_r")), na.rm = TRUE)
#Neuroticism
all.data$IPIP6_Neur <- rowMeans(subset(all.data, select = c("IPIP6_Q4", "IPIP6_Q15_r", "IPIP6_Q16", "IPIP6_Q17_r")), na.rm = TRUE)
#Openness
all.data$IPIP6_Open <- rowMeans(subset(all.data, select = c("IPIP6_Q5", "IPIP6_Q9_r", "IPIP6_Q13_r", "IPIP6_Q21_r")), na.rm = TRUE)
#Honesty-Humiltiy
all.data$IPIP6_HonHum <- rowMeans(subset(all.data, select = c("IPIP6_Q6_r", "IPIP6_Q12_r", "IPIP6_Q18_r", "IPIP6_Q24_r")), na.rm = TRUE)

sum(all.data$IPIP6_HonHum)

#Make cleaned datafile with variables for analysis only
df <- subset(all.data, select = c("ID_num", "Study_inout","Parent_Type_p1","PCG_p1",
                                  "Parent_Type_p3", "PCG_p3" , "Parent_Type_p5",
                                  "PCG_p5","Gender", "Age_p1", "Age_p3",
                                  "Avg_SC_PR_P3", "Avg_Succ_PR_P3", "Avg_Lat_PR_P3",
                                  "Avg_SC_FT_P3", "Avg_Succ_FT_P3","Avg_LAT1_FT_P3",
                                  "Avg_LAT2_FT_P3", "Pi_social_games_freq_p3_fixed",
                                  "Gender_Label", "response.diff", "Neur" ,"Agree",
                                  "Cons","Extra","Open","Parent_Type_p6","PCG_p6", 
                                  "IPIP6_Cons","IPIP6_Neur","IPIP6_Open","IPIP6_HonHum",
                                  "IPIP6_Extra", "IPIP6_Agree"))

ibq.df <- read.csv("IBQ_P1_Masterfile.csv", stringsAsFactors = FALSE)
ibq.df <- subset(ibq.df, select = c("ID_num", "act","dist","fear","dura","smil","hip",
                                    "lip","soot","fall","cud","perc","sad" ,"app",
                                    "voc","SUR","NEG", "REG"))
df <- merge(x = df, y = ibq.df, by = "ID_num", all = TRUE)
df[df == 999] <- NA
summary(df)
str(df)
write.csv(df, "ParentChild_Coop_ReducedData.csv")
```

```{r data subset creation, results = 'hide', include = FALSE}

#Exclude participants who did not complete Phase 3
df$Study_inout[is.na(df$Age_p3)] <- 0

#Exclude all participants who did not complete BOTH cooperative tasks at Phase 3
df$Study_inout[is.na(df$Avg_SC_PR_P3) 
               & is.na(df$Avg_Succ_PR_P3)  
               & is.na(df$Avg_Lat_PR_P3)
               & is.na(df$Avg_SC_FT_P3)
               & is.na(df$Avg_Succ_FT_P3)
               & is.na(df$Avg_LAT1_FT_P3)
               & is.na(df$Avg_LAT2_FT_P3)] <- 0

#Study in data including mothers at P1, P5, and P6 or missing data for imputation

df.m <- df[which(df$Study_inout == 1),]

df.m <- df.m[which(df.m$Parent_Type_p1 == 2 
                     | is.na(df.m$Parent_Type_p1)
                     & df.m$Parent_Type_p5 == 2
                     | is.na(df.m$Parent_Type_p5)
                     & df.m$Parent_Type_p6 == 2
                     | is.na(df.m$Parent_Type_p6)),]



summary(df.m) 

#Exclude IBQ subscale, constants, and admin variables data from df
df.m <- subset(df.m, select = c("ID_num","Study_inout",
                                         "Parent_Type_p1" ,"PCG_p1" ,
                                         "Parent_Type_p3","PCG_p3",
                                         "Parent_Type_p5" ,"PCG_p5" ,
                                         "Parent_Type_p6","PCG_p6","Gender",
                                         "Gender_Label","Age_p1","Age_p3","Avg_SC_PR_P3",
                                         "Avg_Succ_PR_P3", "Avg_Lat_PR_P3","Avg_SC_FT_P3",
                                         "Avg_Succ_FT_P3","Avg_LAT1_FT_P3","Avg_LAT2_FT_P3",
                                         "Pi_social_games_freq_p3_fixed","response.diff" ,
                                         "Neur","Agree" ,"Cons" ,"Extra"  ,"Open" ,
                                         "IPIP6_Cons",
                                         "IPIP6_Neur","IPIP6_Open",
                                         "IPIP6_HonHum","IPIP6_Extra",
                                         "IPIP6_Agree","SUR","NEG","REG"))

#cleaned subset for imputations with extra variables removed as to not throw off predictor matrix
df.c <- subset(df.m, select = c("Gender", "Age_p3", "Avg_SC_PR_P3",
                                "Avg_Succ_PR_P3", "Avg_Lat_PR_P3","Avg_SC_FT_P3",
                                "Avg_Succ_FT_P3","Avg_LAT1_FT_P3","Avg_LAT2_FT_P3",
                                "Pi_social_games_freq_p3_fixed","response.diff" ,
                                "Neur","Agree" ,"Cons" ,"Extra"  ,"Open","SUR","NEG","REG",
                                "IPIP6_Cons", "IPIP6_Neur","IPIP6_Open", "IPIP6_HonHum",
                                "IPIP6_Extra", "IPIP6_Agree"))
```

# Dealing with missing data

## Identify percent missing
```{r percent missing}
#percent missing for each variable
colMeans(is.na(df.c)*100)

#percent missing for entire dataset
sum(is.na(df.c))/prod(dim(df.c))
```
  
Overall, the percent missing for the df isn't too bad ~ 25%. Most of the variables have an acceptable percent missing. However, given the majority of variables have > 5% missing (n = 21), there is a potential that excluding these participants will induce bias within the sample (see https://www.ncbi.nlm.nih.gov/pmc/articles/PMC3701793/).
  
## Identify suitable variables as predictors for imputation 
```{r missing data diagnostics flux plot, results = 'hide'}
fluxplot(
  df.c,
  local = names(df.c),
  plot = TRUE,
  labels = TRUE,
  xlim = c(0, 1),
  ylim = c(0, 1),
  las = 1,
  xlab = "Influx",
  ylab = "Outflux",
  main = paste("Influx-outflux pattern for", deparse(substitute(df.c))),
  eqscplot = TRUE,
  pty = "s",
  lwd = 1,
  pch=19
)



flux(df.c)
```
  
Variables with an outflux < .5 have limitied predicive ability  
Thus, *Avg_LAT2_FT_P3, IPIP6_Cons, IPIP6_Neur, IPIP6_Open, IPIP6_HonHum, IPIP6_Extra, IPIP6_Agree* should be excluded as predictors. This makes sense as well as these variables contain the highest percent missing.

## Imputation of missing data  
```{r mice for missing data, results = 'hide'}
#training set
init = mice(df.c, pred=quickpred(df.c, exclude = c("Gender", "Age_p3")), maxit=0) #Excludes constants and admin var
meth = init$method
predM = init$predictorMatrix

predM[, c("Avg_LAT2_FT_P3","Age_p3", "Gender",
          "IPIP6_Cons", "IPIP6_Neur","IPIP6_Open",
          "IPIP6_HonHum","IPIP6_Extra","IPIP6_Agree")]=0 #Variables with low outflux excluded as predic

meth[c("Age_p3", "Gender")]="" # excluded from predictions

set.seed(103) #for reproducability
df.imp = mice(df.c, m=10, method = meth, predictorMatrix = predM, maxit = 10, print = FALSE)

summary(df.imp)
df.imp$predictorMatrix #check predictor matrix
```

## Imputation dfs diagnostics 
```{r model diagnostics}
#This is to check that the distributions generally follow the same pattern
stripplot(df.imp, pch = c(21, 20), cex = c(1, 1.5))

densityplot(df.imp, layout = c(3, 1))

#Loooks solid!
```

# SEM models

## Notes regarding models
* Run SEM with ML estimator
* There are several potential issues with excluding missing data (see Helena et al. 2009). 
* We should consider removing latency from analyses as high percent missing

## General Process for each of the 4 models
* MI for complete data set to use for correlation tests. Participants are excluded if: < 70% English, born PT, did not complete Phase 3, did not complete at least 1 cooperative task (PRT or CRT) during their Phase 3 visit, or the mother did not complete the questionnaires at either P1, P5, or P6.
  
* Run hypothesized model - assess fit
  
* Run model of best fit based on correlation matrix
  
* Run saturated model from either above model

* Test differences between 3 alternative models using ANOVA

## Model statistics ML method

###Correlation matricies for all model dfs
```{r correlation matrices}
# correlation coefficients of ffm, cvs, prt variables
pr.ffm.res <- miceadds::micombine.cor(mi.res=df.imp, variables=c(3:5,10:19))

# correlation coefficients of ffm, cvs, ft variables
ft.ffm.res <- miceadds::micombine.cor(mi.res=df.imp, variables=c(6:19))

# correlation coefficients of sfm, cvs, prt variables
pr.sfm.res <- miceadds::micombine.cor(mi.res=df.imp, variables=c(3:5,10,11,17:25))

# correlation coefficients of sfm, cvs, prt variables
ft.sfm.res <- miceadds::micombine.cor(mi.res=df.imp, variables=c(6:11,17:25))
```

# Study 1 PRT Model

## Hypothesized model  
*The hypothesized model is a poor fit*
```{r study 1 hypothesized model prt}
#Hypothesized model

h.s1_prt <- '
Avg_SC_PR_P3 ~ a*Agree + b*response.diff + c*NEG + d*SUR + f*Pi_social_games_freq_p3_fixed 
Avg_Succ_PR_P3 ~ g*Agree + h*response.diff + i*NEG + j*SUR + k*Pi_social_games_freq_p3_fixed  
Avg_Lat_PR_P3 ~ l*Agree + m*response.diff + n*NEG + o*SUR + p*Pi_social_games_freq_p3_fixed 

NEG ~ q*Agree
REG ~ r*Agree
Pi_social_games_freq_p3_fixed ~ s*Agree + t*response.diff


indirect1 := q*a
indirect2 := q*g
indirect3 := q*l

indirect3 := r*a
indirect4 := r*g
indirect5 := r*l

indirect6 := s*a
indirect7 := s*g
indirect8 := s*l

indirect9 := t*b
indirect10 := t*h
indirect11 := t*m
'

h.s1_prt.fit <- sem(h.s1_prt, data = df.c,  estimator="mlr", missing = "ML")
summary(h.s1_prt.fit, fit.measures = TRUE)
```

## Correlation based model
```{r study 1 correlational model prt}
#Unsaturated model based on p < .05 from corr matrix of imputed data for consistency across models
us.s1_prt <- '
Avg_SC_PR_P3 ~ e*Agree + f*Neur + a*NEG + b*REG
Avg_Succ_PR_P3 ~ g*Neur 
NEG ~ d*Neur + Cons
REG ~ c*Neur + Cons
indirect1 := d*f
indirect2 := c*g
total := e + (d * f) + (c * g)
NEG ~~ REG
Avg_SC_PR_P3 ~~ Avg_Succ_PR_P3
'

us.fit.s1_prt <- sem(us.s1_prt, df.c, estimator = "mlr", missing = "ML")
summary(us.fit.s1_prt, fit.measures = TRUE)
fitMeasures(us.fit.s1_prt)
standardizedSolution(us.fit.s1_prt)
```

## Alternative Model with direct effects only

```{r study 1 direct effects model prt}
#Temperament not a mediator so removed from model to saturate model
s.s1_prt <- '
Avg_SC_PR_P3 ~ e*Agree + f*Neur
Avg_Succ_PR_P3 ~ g*Neur 
Avg_SC_PR_P3 ~~ Avg_Succ_PR_P3
'
s.fit.s1_prt <- sem(s.s1_prt, df.c, estimator = "mlr", missing = "ML")
summary(s.fit.s1_prt)
lavaanPlot::lavaanPlot(name = "plot", s.fit.s1_prt, coefs = TRUE, stand = TRUE, sig = .05)
```

## Model compare

```{r study 1 model compare prt}
anova(us.fit.s1_prt, s.fit.s1_prt) 
#No significant difference between models suggesting that the saturated model isn't explaining more of the endogeous variables and thus adding the connections in the unsaturated model doesn't change the interpretation and has theoretical value.
```

# Study 1 CRT Model

## Hypothesized model
*The hypothesized model is a poor fit*
```{r study 1 hypothesized model crt}
#Hypothesized model

h.s1_crt <- '
Avg_SC_FT_P3 ~ a*Agree + b*response.diff + c*NEG + d*SUR + f*Pi_social_games_freq_p3_fixed 
Avg_Succ_FT_P3 ~ g*Agree + h*response.diff + i*NEG + j*SUR + k*Pi_social_games_freq_p3_fixed  
Avg_LAT1_FT_P3 ~ l*Agree + m*response.diff + n*NEG + o*SUR + p*Pi_social_games_freq_p3_fixed 
Avg_LAT2_FT_P3 ~ u*Agree + v*response.diff + w*NEG + x*SUR + y*Pi_social_games_freq_p3_fixed 

NEG ~ q*Agree
REG ~ r*Agree
Pi_social_games_freq_p3_fixed ~ s*Agree + t*response.diff


indirect1 := q*a
indirect2 := q*g
indirect3 := q*l
indirect3a := q*u

indirect3 := r*a
indirect4 := r*g
indirect5 := r*l
indirect5a := r*u

indirect6 := s*a
indirect7 := s*g
indirect8 := s*l
indirect8a := s*u

indirect9 := t*b
indirect10 := t*h
indirect11 := t*m
'

h.s1_crt.fit <- sem(h.s1_crt, data = df.c,  estimator="mlr", missing = "ML")
summary(h.s1_crt.fit, fit.measures = TRUE)
```

## Correlation based model
```{r study 1 corr model crt}
#Unsaturated model based on p < .05 from corr matrix
us.s1_crt <- '
Avg_Succ_FT_P3 ~ response.diff 
Avg_SC_FT_P3 ~ response.diff 
Avg_LAT1_FT_P3 ~ response.diff + Open 

REG ~ Neur + Cons + Extra
NEG ~ Cons 
'

us.fit.s1_crt <- sem(us.s1_crt, df.c, estimator = "mlr", missing = "ML")
summary(us.fit.s1_crt, fit.measures = TRUE)
```

## Alternative Model with direct effects only

```{r study 1 saturdated model crt}
s.s1_crt <- '
Avg_Succ_FT_P3 ~ response.diff
Avg_SC_FT_P3 ~ response.diff
Avg_LAT1_FT_P3 ~ response.diff + Open 
'
s.fit.s1_crt <- sem(s.s1_crt, df.c, estimator = "mlr", missing = "ML")
summary(s.fit.s1_crt, fit.measures = TRUE)
```

## Model compare

```{r study 1 model compare crt}
anova(us.fit.s1_crt, s.fit.s1_crt) 
#No significant difference between models suggesting that the saturated model isn't explaining more of the endogeous variables and thus adding the connections in the unsaturated model doesn't change the interpretation and has theoretical value.
```

# Study 2 PRT Model

## Hypothesized model
*The hypothesized model is a poor fit*
```{r study 2 hypothesized model prt}
#Hypothesized model

h.s2_prt <- '
Avg_SC_PR_P3 ~ a*IPIP6_HonHum + b*response.diff + c*NEG + d*SUR + f*Pi_social_games_freq_p3_fixed 
Avg_Succ_PR_P3 ~ g*IPIP6_HonHum + h*response.diff + i*NEG + j*SUR + k*Pi_social_games_freq_p3_fixed  
Avg_Lat_PR_P3 ~ l*IPIP6_HonHum + m*response.diff + n*NEG + o*SUR + p*Pi_social_games_freq_p3_fixed 

NEG ~ q*IPIP6_HonHum
REG ~ r*IPIP6_HonHum
Pi_social_games_freq_p3_fixed ~ s*IPIP6_HonHum + t*response.diff


indirect1 := q*a
indirect2 := q*g
indirect3 := q*l

indirect3 := r*a
indirect4 := r*g
indirect5 := r*l

indirect6 := s*a
indirect7 := s*g
indirect8 := s*l

indirect9 := t*b
indirect10 := t*h
indirect11 := t*m
'

h.s2_prt.fit <- sem(h.s2_prt, data = df.c,  estimator="mlr", missing = "ML")
summary(h.s2_prt.fit, fit.measures = TRUE)
```

## Correlation based model

```{r study 2 corr model prt}

#Unsaturated model based on p < .05 from corr matrix
us.s2_prt <- '
Avg_SC_PR_P3 ~ IPIP6_HonHum 
Avg_Succ_PR_P3 ~ IPIP6_HonHum
Pi_social_games_freq_p3_fixed ~	IPIP6_Open + IPIP6_Extra
SUR ~ IPIP6_HonHum

'
us.fit.s2_prt <- sem(us.s2_prt, df.c, estimator = "mlr", missing = "ML")
summary(us.fit.s2_prt, fit.measures = TRUE)
```

## Alternative Model with direct effects only

```{r study 2 sat model prt}

#saturated model based on p < .05 from corr matrix
s.s2_prt <- '
Avg_SC_PR_P3 ~ IPIP6_HonHum 
Avg_Succ_PR_P3 ~ IPIP6_HonHum

Avg_SC_PR_P3 ~~ Avg_Succ_PR_P3
'
s.fit.s2_prt <- sem(s.s2_prt, df.c, estimator = "mlr", missing = "ML")
summary(s.fit.s2_prt, fit.measures = TRUE)
```

## Model compare

```{r study 2 model compare prt}
anova(s.fit.s2_prt, us.fit.s2_prt) 
#No significant difference between models suggesting that the saturated model isn't explaining more of the endogeous variables and thus adding the connections in the unsaturated model doesn't change the interpretation and has theoretical value.
```

# Study 2 CRT Model

## Hypothesized model
*The hypothesized model is a poor fit*
```{r study 2 hypothesized model crt}
#Hypothesized model

h.s2_crt <- '
Avg_SC_FT_P3 ~ a*IPIP6_HonHum + c*NEG + d*SUR + f*Pi_social_games_freq_p3_fixed 
Avg_Succ_FT_P3 ~ g*IPIP6_HonHum + i*NEG + j*SUR + k*Pi_social_games_freq_p3_fixed  
Avg_LAT1_FT_P3 ~ l*IPIP6_HonHum + n*NEG + o*SUR + p*Pi_social_games_freq_p3_fixed 
Avg_LAT2_FT_P3 ~ u*IPIP6_HonHum + w*NEG + x*SUR + y*Pi_social_games_freq_p3_fixed 

NEG ~ q*IPIP6_HonHum
REG ~ r*IPIP6_HonHum
Pi_social_games_freq_p3_fixed ~ s*IPIP6_HonHum 


indirect1 := q*a
indirect2 := q*g
indirect3 := q*l
indirect3a := q*u

indirect3 := r*a
indirect4 := r*g
indirect5 := r*l
indirect5a := r*u

indirect6 := s*a
indirect7 := s*g
indirect8 := s*l
indirect8a := s*u
'

h.s2_crt.fit <- sem(h.s2_crt, data = df.c,  estimator="mlr", missing = "ML")
summary(h.s2_crt.fit, fit.measures = TRUE)
```

## Correlation based model
**The correlation matrix suggests that IPIP6 personality variables are not related to any endogenous variables and thus a follow up model test is not necessary**

